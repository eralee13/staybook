import{C as E,l as S,i as R,a as L,t as T}from"./tippy-CA5Yw4iR.js";let m=!1,I="",h="",v="";document.addEventListener("DOMContentLoaded",function(){const C=document.getElementById("calendar"),r=new E(C,{schedulerLicenseKey:"GPL-My-Project-Is-Open-Source",plugins:[R,L],locale:S,initialView:"resourceTimelineMonth",initialDate:new Date().toISOString().split("T")[0],resourceAreaHeaderContent:"Номера / Тарифы",nowIndicator:!0,height:"auto",selectable:!0,editable:!1,resources:window.resourcesData??[],events:window.eventsData??[],eventContent:function(t){var e;return{html:`<div style="padding: 5px; text-align: center; font-weight: bold">${((e=t.event)==null?void 0:e.title)??""}</div>`}},eventClick:function(t){var f,b,y,x,k;const e=t.event.startStr.split("T")[0],n=$("#hotel_id").val(),d=$("#hotel_id option:selected").text(),a=((y=(b=(f=t.event).getResources)==null?void 0:b.call(f)[0])==null?void 0:y.id)??((x=t.event._def.resourceIds)==null?void 0:x[0])??"";let l="",u="";if(a&&a.includes("_rate_")){const[D,_]=a.replace("room_","").split("_rate_");l=D,u=_}const p=r.getResourceById(`room_${l}`),g=r.getResourceById(`room_${l}_rate_${u}`);$("#modalHotelId").val(n),$("#modalHotelName").text(d),$("#modalRoomId").val(l),$("#modalRateId").val(u),$("#modalRoomName").text((p==null?void 0:p.title)??"—"),$("#modalRateName").text((g==null?void 0:g.title)??"—"),$("#modalDateRange").val(`${i(e)} - ${i(e)}`),$("#bookingError").addClass("d-none").html(""),(k=$("#modalDateRange").data("daterangepicker"))==null||k.remove(),$("#modalDateRange").daterangepicker({singleDatePicker:!1,showDropdowns:!0,autoApply:!0,startDate:i(e),endDate:i(e),locale:{format:"DD.MM.YYYY",separator:" - ",applyLabel:"Выбрать",cancelLabel:"Отмена",fromLabel:"С",toLabel:"По",customRangeLabel:"Выбрать вручную",weekLabel:"Н",daysOfWeek:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],firstDay:1}}),$("#createBookingModal").modal("show")},eventDidMount:function(t){var a,l;const o=t.event,e=t.el,n=o.backgroundColor||((l=(a=o._def)==null?void 0:a.ui)==null?void 0:l.backgroundColor),d=o.title;o.extendedProps.description&&n==="#d95d5d"&&T(e,{content:`
                        <div style="padding: 4px 8px; font-size: 14px;">
                            <strong>${d}</strong><br>
                            ${o.extendedProps.description}
                        </div>
                    `,allowHTML:!0,theme:"light-border",placement:"right",zIndex:999999}),n&&(e.style.backgroundColor=n,e.style.borderColor=n)},datesSet:function(t){m||(h=t.startStr.split("T")[0],v=t.endStr.split("T")[0],s(r))}});r.render();function i(t){const[o,e,n]=t.split("-");return`${n}.${e}.${o}`}function s(t){if(m)return;m=!0;let o=$("#daterange").val();if(I=$("#hotel_id").val(),o&&o.includes(" - ")){const e=o.split(" - ");h=e[0].trim().split(".").reverse().join("-"),v=e[1].trim().split(".").reverse().join("-")}fetch(`/auth/bookcalendarprice/books/events?hotel_id=${I}&start=${h}&end=${v}`).then(e=>e.json()).then(e=>{t.removeAllEventSources(),t.setOption("resources",e.resources),t.addEventSource(e.events)}).catch(e=>{console.error("Ошибка загрузки:",e),c("Ошибка загрузки календаря","danger")}).finally(()=>{m=!1})}$("#createBookingModal").on("show.bs.modal",function(){$("#bookingError").addClass("d-none").html("")}),document.getElementById("createBookingForm").addEventListener("submit",function(t){t.preventDefault();const o=$("#modalDateRange").val()??"";console.log("Диапазон:",o);const[e,n]=o.includes(" - ")?o.split(" - "):[null,null];if(!e||!n||e.length<6||n.length<6){w("Выберите корректный диапазон дат.");return}const d={hotel_id:$("#modalHotelId").val(),rate_id:$("#modalRateId").val(),room_id:$("#modalRoomId").val(),start:e.trim().split(".").reverse().join("-"),end:n.trim().split(".").reverse().join("-"),allotment:$("#modalAllotment").val()};fetch("/auth/bookcalendarprice/books/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify(d)}).then(a=>a.json()).then(a=>{a.success?($("#createBookingModal").modal("hide"),c("Цена успешно обновлена","success"),s(r)):a.error&&c(a.message||"Ошибка при обновлении цены","danger")}).catch(()=>{c("Ошибка соединения с сервером.","danger")})});function w(t){const o=$("#bookingError");o.removeClass("d-none").html(t),setTimeout(()=>{o.addClass("d-none").html("")},5e3)}function c(t,o="success"){const e=document.createElement("div");e.textContent=t,e.className="toast-message",Object.assign(e.style,{position:"fixed",top:"20px",right:"20px",backgroundColor:o==="danger"?"#dc3545":"#28a745",color:"white",padding:"10px 20px",borderRadius:"6px",zIndex:1e4,boxShadow:"0 0 10px rgba(0,0,0,0.15)",fontSize:"15px"}),document.body.appendChild(e),setTimeout(()=>e.remove(),4e3)}s(r),document.getElementById("hotel_id").addEventListener("change",()=>{s(r)}),$("#daterange").on("apply.daterangepicker",function(){s(r)})});
